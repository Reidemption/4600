(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[784],{8785:function(e,i,t){(window.__NEXT_P=window.__NEXT_P||[]).push(["/connect",function(){return t(8637)}])},165:function(e,i,t){"use strict";var r=t(5893),n=t(204),d=t(6684),s=t(8911),a=t(5034),o=t(9222),l=t(3247),u=t(1618),c=t(7294);let f=e=>{let{request:i,acceptRequest:t,rejectRequest:f,loading:h}=e,[v,g]=c.useState(null),x=async()=>{let e=await (0,l.QT)((0,l.JU)(u.RZ,"users",null==i?void 0:i.friend_id));if(e.data()){var t,r;g((null===(t=null==e?void 0:e.data())||void 0===t?void 0:t.displayName)||(null===(r=null==e?void 0:e.data())||void 0===r?void 0:r.email))}};return(0,c.useEffect)(()=>{(async function(){await x()})()},[]),(0,r.jsxs)(n.k,{border:"1px",borderColor:"gray",borderRadius:"md",p:4,mb:4,w:"full",alignItems:"center",justifyContent:"space-between",children:[(0,r.jsxs)(d.K,{direction:"column",children:[v&&(0,r.jsx)(s.x,{fontWeight:"bold",children:v}),(0,r.jsx)(s.x,{children:i.status})]}),(0,r.jsx)(a.L,{}),(0,r.jsxs)(d.K,{direction:"row",children:["accepted"!=i.status&&(0,r.jsx)(o.z,{colorScheme:"green",isLoading:h,onClick:()=>{t(i)},children:"Accept"}),"rejected"!=i.status&&(0,r.jsx)(o.z,{colorScheme:"red",isLoading:h,onClick:()=>{f(i)},children:"Reject"})]})]})};i.Z=f},8637:function(e,i,t){"use strict";t.r(i);var r=t(5893),n=t(7754),d=t(6684),s=t(204),a=t(8129),o=t(8911),l=t(9222),u=t(7294),c=t(3247),f=t(1618),h=t(6383),v=t(165);let g=()=>{let[e,i]=u.useState(""),[t,g]=u.useState(""),[x,m]=u.useState(""),[_,p]=u.useState(!1),[w,y]=u.useState(null),[j,E]=u.useState([]),[b,S]=u.useState(""),[R,C]=u.useState(""),[Z,k]=u.useState(!1),[q,I]=u.useState(!1),J=async i=>{p(!0),i.preventDefault();try{if(e===(null==w?void 0:w.email))throw Error("You cannot add yourself as a friend!");await (0,c.i3)(f.RZ,async i=>{var t,r,n,d;let s;let a=(0,c.IO)((0,c.hJ)(f.RZ,"users"),(0,c.ar)("email","==",e)),o=await (0,c.PL)(a);if(o.forEach(e=>{s=e.data()}),!s)throw Error("error finding friend's document");let l=(0,c.JU)(f.RZ,"friends",s.uid),u=await i.get(l),h={friend_id:w.uid,status:"pending",sender_id:w.uid},v=(0,c.JU)(f.RZ,"friends",null==w?void 0:w.uid),g=await i.get(v),x={friend_id:s.uid,status:"pending",sender_id:w.uid};u.exists()&&(null===(t=u.data())||void 0===t?void 0:t.friends)?i.update(l,{friends:[...null===(n=u.data())||void 0===n?void 0:n.friends,h]}):(console.log("creating frienddoc friends array field"),i.set(l,{friends:[h]})),g.exists()&&(null===(r=g.data())||void 0===r?void 0:r.friends)?i.update(v,{friends:[...null===(d=g.data())||void 0===d?void 0:d.friends,x]}):(console.log("creating submitter friends array field"),i.set(v,{friends:[x]}))}),m("Friend request sent!")}catch(e){g(e.message)}p(!1)},N=e=>{i(e.target.value)},T=async e=>{k(!0),await L(e,"accepted"),await z(),k(!1)},U=async e=>{k(!0),await L(e,"rejected"),await z(),k(!1)},L=async(e,i)=>{try{await (0,c.i3)(f.RZ,async t=>{var r,n,d,s,a,o;let l={friend_id:e.friend_id,status:i,sender_id:e.sender_id},u={friend_id:w.uid,status:i,sender_id:e.sender_id},h=(0,c.JU)(f.RZ,"friends",w.uid),v=await t.get(h),g=(0,c.JU)(f.RZ,"friends",e.sender_id),x=await t.get(g);if(!v.exists()||!(null===(r=v.data())||void 0===r?void 0:r.friends))throw console.log("Error finding document"),Error("error finding friend's document");let m=null===(n=v.data())||void 0===n?void 0:n.friends.findIndex(i=>i.friend_id===e.friend_id&&i.sender_id===e.sender_id&&i.status===e.status);if(-1===m)throw Error("error finding index of friend's document");let _=[...null===(d=v.data())||void 0===d?void 0:d.friends];if(_[m]=l,t.update(h,{friends:[..._]}),!x.exists()||!(null===(s=x.data())||void 0===s?void 0:s.friends))throw Error("error finding friend request");let p=null===(a=x.data())||void 0===a?void 0:a.friends.findIndex(i=>w.uid===i.friend_id&&i.sender_id===e.sender_id&&i.status===e.status);if(-1===p)throw Error("error finding friend request");let y=[...null===(o=x.data())||void 0===o?void 0:o.friends];y[p]=u,t.update(g,{friends:[...y]})}),m("Friend request ".concat(i,"!")),setTimeout(()=>{m("")},1500)}catch(e){g(e.message)}},z=async()=>{p(!0);let e=(0,h.v0)();(0,h.Aj)(e,async e=>{try{var i;if(!e)throw Error("User error. Try again later.");y(e);let t=(0,c.JU)(f.RZ,"friends",e.uid),r=await (0,c.QT)(t);if(!r.exists())throw Error("Possibility of no friends.");let n=null===(i=r.data())||void 0===i?void 0:i.friends;E(n)}catch(e){console.log("Error detected in getRequests",e)}}),p(!1)},A=(null==j?void 0:j.length)>0;return(0,u.useEffect)(()=>{(async function(){z()})()},[]),(0,r.jsx)(n.M,{h:"100vh",children:(0,r.jsxs)(d.K,{direction:"column",children:[!_&&A&&j.filter(e=>e.sender_id!=w.uid).filter(e=>"pending"===e.status).map((e,i)=>(0,r.jsx)(v.Z,{request:e,rejectRequest:U,acceptRequest:T,loading:Z},i)),(0,r.jsx)(s.k,{border:"2px",p:"3",borderColor:"GrayText",children:(0,r.jsxs)(d.K,{direction:"column",align:"center",alignItems:"center",children:[(0,r.jsx)("h1",{children:"Enhance your Choredom experience by following your friends!"}),(0,r.jsxs)("form",{onSubmit:J,children:[(0,r.jsx)(a.I,{placeholder:"Enter friend's email",onChange:N,px:"2"}),t&&(0,r.jsx)(o.x,{textAlign:"center",color:"red.500",children:t}),x&&(0,r.jsx)(o.x,{textAlign:"center",color:"green",children:x}),(0,r.jsx)(l.z,{mt:"3",w:"100%",type:"submit",colorScheme:"purple",isLoading:_,children:"Search"})]})]})})]})})};i.default=g},7754:function(e,i,t){"use strict";t.d(i,{M:function(){return s}});var r=t(9513),n=t(5059),d=t(5893),s=(0,r.m)("div",{baseStyle:{display:"flex",alignItems:"center",justifyContent:"center"}});s.displayName="Center";var a={horizontal:{insetStart:"50%",transform:"translateX(-50%)"},vertical:{top:"50%",transform:"translateY(-50%)"},both:{insetStart:"50%",top:"50%",transform:"translate(-50%, -50%)"}};(0,n.G)(function(e,i){let{axis:t="both",...n}=e;return(0,d.jsx)(r.m.div,{ref:i,__css:a[t],...n,position:"absolute"})})}},function(e){e.O(0,[774,888,179],function(){return e(e.s=8785)}),_N_E=e.O()}]);